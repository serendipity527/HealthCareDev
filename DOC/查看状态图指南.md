# ğŸ¨ æŸ¥çœ‹åŒ»ç–—å’¨è¯¢çŠ¶æ€å›¾æŒ‡å—

## ğŸ“ æŸ¥çœ‹ä½ç½®

ä½ å¯ä»¥é€šè¿‡ **3 ç§æ–¹å¼** æŸ¥çœ‹æ„å»ºçš„çŠ¶æ€å›¾ï¼š

### æ–¹å¼ 1: å¯åŠ¨æ—¶è‡ªåŠ¨æ‰“å° âœ… **æœ€æ–¹ä¾¿**

å½“ä½ å¯åŠ¨ Spring Boot åº”ç”¨æ—¶ï¼ŒçŠ¶æ€å›¾ä¼šè‡ªåŠ¨æ‰“å°åˆ°æ§åˆ¶å°ã€‚

**æŸ¥çœ‹æ­¥éª¤ï¼š**
1. å¯åŠ¨åº”ç”¨
   ```bash
   mvn spring-boot:run
   ```

2. åœ¨æ§åˆ¶å°æ—¥å¿—ä¸­æŸ¥æ‰¾ä»¥ä¸‹å†…å®¹ï¼š
   ```
   ========================================
   åŒ»ç–—å’¨è¯¢çŠ¶æ€å›¾ (Mermaid æ ¼å¼)
   ========================================
   graph TD
       __start__ --> initial
       initial --> intent_router
       ...
   ========================================
   åœ¨çº¿é¢„è§ˆ: https://mermaid.live/
   å°†ä»¥ä¸Š Mermaid ä»£ç å¤åˆ¶åˆ°åœ¨çº¿ç¼–è¾‘å™¨å³å¯æŸ¥çœ‹å›¾å½¢
   ========================================
   ```

3. å¤åˆ¶ `graph TD` åˆ° `END` ä¹‹é—´çš„æ‰€æœ‰å†…å®¹

4. è®¿é—® https://mermaid.live/ å¹¶ç²˜è´´å†…å®¹å³å¯æŸ¥çœ‹å¯è§†åŒ–å›¾å½¢

### æ–¹å¼ 2: é€šè¿‡ API è·å–ï¼ˆJSON æ ¼å¼ï¼‰

**API ç«¯ç‚¹ï¼š**
```
GET http://localhost:8080/api/consultation/graph
```

**ä½¿ç”¨ curlï¼š**
```bash
curl http://localhost:8080/api/consultation/graph
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "mermaid": "graph TD\n    __start__ --> initial\n    ...",
  "previewUrl": "https://mermaid.live/",
  "description": "å¤åˆ¶ mermaid å­—æ®µçš„å†…å®¹åˆ°åœ¨çº¿ç¼–è¾‘å™¨å³å¯æŸ¥çœ‹å›¾å½¢"
}
```

**æµè§ˆå™¨è®¿é—®ï¼š**
```
http://localhost:8080/api/consultation/graph
```

### æ–¹å¼ 3: é€šè¿‡ API è·å–ï¼ˆçº¯æ–‡æœ¬æ ¼å¼ï¼‰âœ… **æœ€é€‚åˆå¤åˆ¶**

**API ç«¯ç‚¹ï¼š**
```
GET http://localhost:8080/api/consultation/graph/raw
```

**ä½¿ç”¨ curlï¼š**
```bash
curl http://localhost:8080/api/consultation/graph/raw
```

**æµè§ˆå™¨è®¿é—®ï¼š**
```
http://localhost:8080/api/consultation/graph/raw
```

è¿™ä¸ªç«¯ç‚¹ç›´æ¥è¿”å›çº¯ Mermaid æ–‡æœ¬ï¼Œæ–¹ä¾¿å¤åˆ¶ã€‚

## ğŸ¨ å¯è§†åŒ–çŠ¶æ€å›¾

### åœ¨çº¿å·¥å…·

å°†è·å–åˆ°çš„ Mermaid ä»£ç ç²˜è´´åˆ°ä»¥ä¸‹ä»»ä¸€åœ¨çº¿ç¼–è¾‘å™¨ï¼š

1. **Mermaid Live Editor** ï¼ˆæ¨èï¼‰
   - ç½‘å€: https://mermaid.live/
   - ç‰¹ç‚¹: å®˜æ–¹ç¼–è¾‘å™¨ï¼ŒåŠŸèƒ½æœ€å…¨
   - å¯ä»¥å®æ—¶é¢„è§ˆã€å¯¼å‡ºå›¾ç‰‡ã€åˆ†äº«é“¾æ¥

2. **Mermaid Chart**
   - ç½‘å€: https://www.mermaidchart.com/
   - ç‰¹ç‚¹: æ›´ä¸“ä¸šçš„å›¾è¡¨å·¥å…·
   - æ”¯æŒå›¢é˜Ÿåä½œ

3. **GitHub/GitLab**
   - åœ¨ Markdown æ–‡ä»¶ä¸­ç›´æ¥ä½¿ç”¨
   ```markdown
   \```mermaid
   graph TD
       __start__ --> initial
       ...
   \```
   ```

### IDE æ’ä»¶

**VS Code:**
```
å®‰è£…æ’ä»¶: Markdown Preview Mermaid Support
```

**IntelliJ IDEA:**
```
å®‰è£…æ’ä»¶: Mermaid
```

**Markdown æ–‡ä»¶ä¸­ä½¿ç”¨:**
````markdown
```mermaid
graph TD
    __start__ --> initial
    initial --> intent_router
    intent_router --> information_gathering
    information_gathering --> safety_check
    safety_check --> save_summary
    save_summary --> __end__
    emergency_response --> __end__
    general_chat --> __end__
```
````

## ğŸ“Š å½“å‰çŠ¶æ€å›¾ç»“æ„

### ç®€åŒ–æµç¨‹ï¼ˆå½“å‰å®ç°ï¼‰

```
START
  â†“
Initial (åˆå§‹åŒ–)
  â†“
IntentRouter (æ„å›¾è·¯ç”±)
  â†“
InformationGathering (ä¿¡æ¯æ”¶é›†)
  â†“
SafetyCheck (å®‰å…¨æ£€æŸ¥)
  â†“
SaveSummary (ä¿å­˜ç—…å†)
  â†“
END
```

### å®Œæ•´æµç¨‹ï¼ˆè®¡åˆ’ä¸­ï¼‰

```
START
  â†“
Initial (åˆå§‹åŒ–)
  â†“
IntentRouter (æ„å›¾è·¯ç”±)
  â”œâ”€[é«˜å±]â†’ EmergencyResponse â†’ END
  â”œâ”€[èŠå¤©]â†’ GeneralChat â†’ END
  â””â”€[åŒ»ç–—]â†’ InformationGathering
              â”œâ”€[é£é™©å‡çº§]â†’ EmergencyResponse â†’ END
              â”œâ”€[éœ€è¦æ›´å¤šä¿¡æ¯]â†’ InformationGathering (å¾ªç¯)
              â””â”€[ä¿¡æ¯å……è¶³]â†’ SafetyCheck â†’ SaveSummary â†’ END
```

## ğŸ” Mermaid ä»£ç è¯´æ˜

### åŸºæœ¬è¯­æ³•

```mermaid
graph TD
    A[èŠ‚ç‚¹A] --> B[èŠ‚ç‚¹B]
    B --> C{æ¡ä»¶åˆ¤æ–­}
    C -->|æ¡ä»¶1| D[èŠ‚ç‚¹D]
    C -->|æ¡ä»¶2| E[èŠ‚ç‚¹E]
```

### èŠ‚ç‚¹ç±»å‹

- `[æ–¹æ¡†]` - æ™®é€šèŠ‚ç‚¹
- `{è±å½¢}` - æ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹
- `((åœ†å½¢))` - èµ·å§‹/ç»“æŸèŠ‚ç‚¹
- `>å¼‚å½¢]` - ç‰¹æ®ŠèŠ‚ç‚¹

### è¾¹çš„ç±»å‹

- `-->` - å®çº¿ç®­å¤´
- `-.->` - è™šçº¿ç®­å¤´
- `==>` - ç²—çº¿ç®­å¤´
- `-->|æ ‡ç­¾|` - å¸¦æ ‡ç­¾çš„ç®­å¤´

## ğŸ“ ç¤ºä¾‹è¾“å‡º

### å®é™…çš„ Mermaid ä»£ç ç¤ºä¾‹

```mermaid
graph TD
    __start__((å¼€å§‹)) --> initial[åˆå§‹åŒ–èŠ‚ç‚¹]
    initial --> intent_router[æ„å›¾è·¯ç”±èŠ‚ç‚¹]
    intent_router --> information_gathering[ä¿¡æ¯æ”¶é›†èŠ‚ç‚¹]
    information_gathering --> safety_check[å®‰å…¨æ£€æŸ¥èŠ‚ç‚¹]
    safety_check --> save_summary[ä¿å­˜ç—…å†èŠ‚ç‚¹]
    save_summary --> __end__((ç»“æŸ))
    
    emergency_response[ç´§æ€¥å“åº”èŠ‚ç‚¹] --> __end__
    general_chat[é€šç”¨èŠå¤©èŠ‚ç‚¹] --> __end__
    
    style __start__ fill:#e1f5e1
    style __end__ fill:#ffe1e1
    style emergency_response fill:#ffcccc
    style information_gathering fill:#cce5ff
    style safety_check fill:#fff4cc
```

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1: å¯åŠ¨æ—¶æ²¡æœ‰çœ‹åˆ°çŠ¶æ€å›¾ï¼Ÿ

**æ£€æŸ¥é¡¹ï¼š**
1. ç¡®è®¤æ—¥å¿—çº§åˆ«ä¸º DEBUG æˆ– INFO
2. æŸ¥çœ‹å®Œæ•´çš„å¯åŠ¨æ—¥å¿—
3. æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯å¯¼è‡´å¯åŠ¨å¤±è´¥

**æŸ¥çœ‹æ—¥å¿—é…ç½®ï¼š**
```yaml
# application.yml
logging:
  level:
    com.yihu.agent: DEBUG
```

### Q2: API è¿”å›é”™è¯¯ï¼Ÿ

**æ£€æŸ¥é¡¹ï¼š**
1. ç¡®è®¤åº”ç”¨å·²æˆåŠŸå¯åŠ¨
2. ç¡®è®¤ç«¯å£ 8080 æ²¡æœ‰è¢«å ç”¨
3. æ£€æŸ¥å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š
   ```bash
   curl http://localhost:8080/api/consultation/health
   ```

### Q3: Mermaid ä»£ç æ— æ³•æ¸²æŸ“ï¼Ÿ

**å¯èƒ½åŸå› ï¼š**
1. å¤åˆ¶çš„ä»£ç ä¸å®Œæ•´
2. åœ¨çº¿ç¼–è¾‘å™¨ç‰ˆæœ¬é—®é¢˜
3. è¯­æ³•é”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®ä¿å¤åˆ¶äº†å®Œæ•´çš„ä»£ç ï¼ˆä» `graph TD` åˆ°æœ€åï¼‰
2. å°è¯•ä¸åŒçš„åœ¨çº¿ç¼–è¾‘å™¨
3. æ£€æŸ¥æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦

### Q4: æƒ³è¦å¯¼å‡ºä¸ºå›¾ç‰‡ï¼Ÿ

**åœ¨ Mermaid Live Editor ä¸­ï¼š**
1. ç²˜è´´ä»£ç å¹¶æ¸²æŸ“
2. ç‚¹å‡»å³ä¸Šè§’çš„ "Actions" æŒ‰é’®
3. é€‰æ‹© "Download PNG" æˆ– "Download SVG"

## ğŸ¯ å¿«é€Ÿæµ‹è¯•

**ä¸€é”®è·å–å¹¶æŸ¥çœ‹çŠ¶æ€å›¾ï¼š**

```bash
# 1. å¯åŠ¨åº”ç”¨
mvn spring-boot:run

# 2. è·å–çŠ¶æ€å›¾ï¼ˆæ–°ç»ˆç«¯ï¼‰
curl http://localhost:8080/api/consultation/graph/raw > graph.txt

# 3. æ‰“å¼€ graph.txt å¹¶å¤åˆ¶å†…å®¹åˆ° https://mermaid.live/
```

**PowerShell ç‰ˆæœ¬ï¼š**
```powershell
# è·å–å¹¶æ‰“å¼€
Invoke-WebRequest -Uri "http://localhost:8080/api/consultation/graph/raw" -OutFile "graph.txt"
notepad graph.txt
```

## ğŸ“š ç›¸å…³èµ„æº

- **Mermaid å®˜æ–¹æ–‡æ¡£**: https://mermaid.js.org/
- **Mermaid Live Editor**: https://mermaid.live/
- **Mermaid è¯­æ³•æ•™ç¨‹**: https://mermaid.js.org/intro/syntax-reference.html
- **LangGraph4j æ–‡æ¡£**: https://langgraph4j.github.io/langgraph4j/

## ğŸ’¡ æç¤º

1. **å¯åŠ¨æ—¶æŸ¥çœ‹æœ€ç›´æ¥**ï¼šåº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰“å°ï¼Œæ— éœ€é¢å¤–æ“ä½œ
2. **API æ–¹å¼æ›´çµæ´»**ï¼šå¯ä»¥éšæ—¶è·å–ï¼Œé€‚åˆé›†æˆåˆ°å…¶ä»–å·¥å…·
3. **åœ¨çº¿ç¼–è¾‘å™¨æ”¯æŒå¯¼å‡º**ï¼šå¯ä»¥å¯¼å‡ºä¸º PNGã€SVGã€PDF ç­‰æ ¼å¼
4. **å¯ä»¥æ·»åŠ åˆ°æ–‡æ¡£**ï¼šå°† Mermaid ä»£ç æ·»åŠ åˆ° README.md æˆ–å…¶ä»–æ–‡æ¡£ä¸­

---

**æ›´æ–°æ—¶é—´**: 2025-11-05  
**ç›¸å…³æ–‡ä»¶**: 
- `src/main/java/com/yihu/agent/service/MedicalConsultationService.java`
- `src/main/java/com/yihu/agent/controller/MedicalConsultationController.java`


