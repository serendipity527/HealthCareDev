# ğŸš€ åŒ»ç–—å’¨è¯¢ç³»ç»Ÿå¯åŠ¨å’Œè®¿é—®æŒ‡å—

## âœ… æ‰€æœ‰é—®é¢˜å·²ä¿®å¤

### 1. Bean å†²çª âœ“
- âŒ **é—®é¢˜**: `openAiChatModel` bean å®šä¹‰å†²çª
- âœ… **è§£å†³**: åˆ é™¤è‡ªå®šä¹‰çš„ `LangChain4jConfig`ï¼Œä½¿ç”¨ Spring Boot Starter è‡ªåŠ¨é…ç½®

### 2. CORS è·¨åŸŸ âœ“
- âŒ **é—®é¢˜**: `strict-origin-when-cross-origin` é”™è¯¯
- âœ… **è§£å†³**: æ·»åŠ ä¸‰å±‚ CORS é…ç½®ï¼ˆCorsConfig + WebConfig + Controller æ³¨è§£ï¼‰

### 3. allowCredentials å†²çª âœ“
- âŒ **é—®é¢˜**: `allowedOrigins("*")` ä¸ `allowCredentials(true)` å†²çª
- âœ… **è§£å†³**: å…¨éƒ¨æ”¹ä¸º `allowedOriginPatterns("*")` æˆ– `originPatterns = "*"`

### 4. å‰ç«¯è®¿é—®è·¯å¾„ âœ“
- âŒ **é—®é¢˜**: åœ¨ IDE å†…ç½®æœåŠ¡å™¨ä¸­æ‰“å¼€ HTML å¯¼è‡´ 404
- âœ… **è§£å†³**: å‰ç«¯ä»£ç è‡ªåŠ¨æ£€æµ‹ç«¯å£ï¼Œæ”¯æŒä¸¤ç§è®¿é—®æ–¹å¼

## ğŸ¯ æ­£ç¡®çš„å¯åŠ¨æ­¥éª¤

### æ­¥éª¤ 1: é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

å¦‚æœä¸ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

**Windows (PowerShell):**
```powershell
$env:AI_API_KEY="your-api-key"
$env:AI_BASE_URL="https://dashscope.aliyuncs.com/compatible-mode/v1"
$env:AI_MODEL_NAME="qwen-plus"
```

**Windows (CMD):**
```cmd
set AI_API_KEY=your-api-key
set AI_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
set AI_MODEL_NAME=qwen-plus
```

**Linux/Mac:**
```bash
export AI_API_KEY="your-api-key"
export AI_BASE_URL="https://dashscope.aliyuncs.com/compatible-mode/v1"
export AI_MODEL_NAME="qwen-plus"
```

### æ­¥éª¤ 2: å¯åŠ¨ Spring Boot åº”ç”¨

**æ–¹æ³• A: ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰**
```bash
./start-medical-consultation.bat    # Windows
./start-medical-consultation.sh     # Linux/Mac
```

**æ–¹æ³• B: ä½¿ç”¨ Maven**
```bash
mvn spring-boot:run
```

**æ–¹æ³• C: åœ¨ IDE ä¸­è¿è¡Œ**
- æ‰¾åˆ° `src/main/java/com/yihu/agent/HealthCareDev` ä¸»ç±»
- å³é”® â†’ Run

### æ­¥éª¤ 3: è®¿é—®åº”ç”¨

**âœ… æ­£ç¡®çš„è®¿é—®æ–¹å¼ï¼š**

é€šè¿‡ Spring Boot åº”ç”¨è®¿é—®ï¼ˆç«¯å£ 8080ï¼‰ï¼š
```
http://localhost:8080/medical-consultation.html
```

**âŒ é”™è¯¯çš„è®¿é—®æ–¹å¼ï¼š**

ä¸è¦åœ¨ IDE ä¸­å³é”® HTML æ–‡ä»¶ â†’ "Open in Browser"ï¼Œè¿™ä¼šä½¿ç”¨ IDE çš„å†…ç½®æœåŠ¡å™¨ï¼ˆç«¯å£ 63342ï¼‰è€Œä¸æ˜¯ Spring Bootã€‚

## ğŸ“± ä½¿ç”¨ç•Œé¢

### å‰ç«¯é¡µé¢åŠŸèƒ½

1. **æ™ºèƒ½åŒ»ç–—å’¨è¯¢åŠ©æ‰‹**
   - è¾“å…¥å¥åº·é—®é¢˜å¹¶è·å¾— AI å»ºè®®
   - æ”¯æŒå¿«é€Ÿé—®é¢˜æŒ‰é’®
   - å®æ—¶å¯¹è¯æ˜¾ç¤º

2. **å¿«é€Ÿå’¨è¯¢ç¤ºä¾‹**
   - å¤´ç–¼é—®é¢˜
   - å¤±çœ å›°æ‰°
   - æ„Ÿå†’æŠ¤ç†
   - æ—¥å¸¸èŠå¤©

### API ç«¯ç‚¹

#### 1. å¥åº·æ£€æŸ¥
```bash
GET http://localhost:8080/api/consultation/health
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "status": "ok",
  "service": "Medical Consultation Service"
}
```

#### 2. åŒ»ç–—å’¨è¯¢
```bash
POST http://localhost:8080/api/consultation/ask
Content-Type: application/json

{
  "userId": "user_123",
  "message": "æˆ‘æœ€è¿‘æ€»æ˜¯å¤´ç–¼ï¼Œæ€ä¹ˆåŠï¼Ÿ"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "userId": "user_123",
  "response": "æ ¹æ®æ‚¨çš„æè¿°ï¼Œå¤´ç–¼å¯èƒ½æœ‰å¤šç§åŸå› ..."
}
```

## ğŸ§ª æµ‹è¯•åº”ç”¨

### æµ‹è¯• 1: å¥åº·æ£€æŸ¥

**æµè§ˆå™¨è®¿é—®ï¼š**
```
http://localhost:8080/api/consultation/health
```

**æˆ–ä½¿ç”¨ curlï¼š**
```bash
curl http://localhost:8080/api/consultation/health
```

**é¢„æœŸç»“æœï¼š**
```json
{"status":"ok","service":"Medical Consultation Service"}
```

### æµ‹è¯• 2: åŒ»ç–—å’¨è¯¢ API

**ä½¿ç”¨ curlï¼š**
```bash
curl -X POST http://localhost:8080/api/consultation/ask \
  -H "Content-Type: application/json" \
  -d "{\"userId\":\"test\",\"message\":\"ä½ å¥½\"}"
```

**æˆ–ä½¿ç”¨ PowerShellï¼š**
```powershell
$body = @{
    userId = "test"
    message = "ä½ å¥½"
} | ConvertTo-Json

Invoke-WebRequest -Uri "http://localhost:8080/api/consultation/ask" `
  -Method POST `
  -ContentType "application/json" `
  -Body $body
```

### æµ‹è¯• 3: å‰ç«¯ç•Œé¢

1. è®¿é—® `http://localhost:8080/medical-consultation.html`
2. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ï¼š"æˆ‘æœ€è¿‘æ€»æ˜¯å¤´ç–¼"
3. ç‚¹å‡»"å‘é€"æˆ–æŒ‰ Enter é”®
4. ç­‰å¾… AI å“åº”

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: åº”ç”¨å¯åŠ¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
APPLICATION FAILED TO START
```

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥ç«¯å£ 8080 æ˜¯å¦è¢«å ç”¨
   ```bash
   # Windows
   netstat -ano | findstr :8080
   
   # Linux/Mac
   lsof -i :8080
   ```

2. æ£€æŸ¥ Java ç‰ˆæœ¬ï¼ˆéœ€è¦ Java 17+ï¼‰
   ```bash
   java -version
   ```

3. æ£€æŸ¥ `application.yml` é…ç½®æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 2: 404 Not Found

**é”™è¯¯ä¿¡æ¯ï¼š**
```
POST http://localhost:63342/api/consultation/ask 404 (Not Found)
```

**åŸå› ï¼š** åœ¨ IDE å†…ç½®æœåŠ¡å™¨ä¸­æ‰“å¼€äº† HTML æ–‡ä»¶

**è§£å†³ï¼š** é€šè¿‡ Spring Boot åº”ç”¨è®¿é—®
```
http://localhost:8080/medical-consultation.html
```

### é—®é¢˜ 3: CORS é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Access to fetch at 'http://localhost:8080/api/consultation/ask' 
from origin 'http://localhost:63342' has been blocked by CORS policy
```

**è§£å†³ï¼š**
1. ç¡®è®¤ CORS é…ç½®å·²ç”Ÿæ•ˆï¼ˆæ£€æŸ¥æ—¥å¿—ï¼‰
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
3. ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„è®¿é—®åœ°å€

### é—®é¢˜ 4: AI è°ƒç”¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
å¤„ç†è¯·æ±‚å¤±è´¥: Connection refused
```

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®é…ç½®
2. æ£€æŸ¥ API Base URL æ˜¯å¦å¯è®¿é—®
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š
   ```bash
   tail -f logs/spring.log
   ```

### é—®é¢˜ 5: Bean å®šä¹‰å†²çª

**é”™è¯¯ä¿¡æ¯ï¼š**
```
A bean with that name has already been defined
```

**è§£å†³ï¼š**
- ç¡®è®¤å·²åˆ é™¤ `src/main/java/com/yihu/agent/config/LangChain4jConfig.java`
- æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘ï¼š
  ```bash
  mvn clean install
  ```

## ğŸ“Š åº”ç”¨çŠ¶æ€ç›‘æ§

### æŸ¥çœ‹æ—¥å¿—

**åº”ç”¨æ—¥å¿—çº§åˆ«ï¼š**
```yaml
logging:
  level:
    com.yihu.agent: DEBUG
    dev.langchain4j: DEBUG
```

**å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼š**
- åœ¨ IDE æ§åˆ¶å°æŸ¥çœ‹
- æˆ–æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼ˆå¦‚æœé…ç½®äº†æ–‡ä»¶è¾“å‡ºï¼‰

### å…³é”®æ—¥å¿—ä¿¡æ¯

**å¯åŠ¨æˆåŠŸæ ‡å¿—ï¼š**
```
[main] INFO  o.s.b.w.e.t.TomcatWebServer - Tomcat started on port(s): 8080
[main] INFO  c.y.a.HealthCareDev - Started HealthCareDev in X.XXX seconds
```

**CORS é…ç½®ç”Ÿæ•ˆï¼š**
```
[main] DEBUG c.y.a.c.CorsConfig - CORS configuration initialized
```

**çŠ¶æ€å›¾åˆå§‹åŒ–ï¼š**
```
[main] INFO  c.y.a.g.MedicalConsultationGraph - åŒ»ç–—å’¨è¯¢çŠ¶æ€å›¾æ„å»ºå®Œæˆ
[main] INFO  c.y.a.s.MedicalConsultationService - åŒ»ç–—å’¨è¯¢çŠ¶æ€å›¾åˆå§‹åŒ–å®Œæˆ
```

## ğŸ¯ å¿«é€Ÿæµ‹è¯•æµç¨‹

**1 åˆ†é’Ÿå¿«é€Ÿæµ‹è¯•ï¼š**

```bash
# 1. å¯åŠ¨åº”ç”¨ï¼ˆæ–°ç»ˆç«¯ï¼‰
mvn spring-boot:run

# 2. ç­‰å¾…å¯åŠ¨å®Œæˆï¼ˆçœ‹åˆ° "Started HealthCareDev"ï¼‰

# 3. æµ‹è¯•å¥åº·æ£€æŸ¥ï¼ˆæ–°ç»ˆç«¯ï¼‰
curl http://localhost:8080/api/consultation/health

# 4. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
start http://localhost:8080/medical-consultation.html

# 5. è¾“å…¥é—®é¢˜å¹¶æµ‹è¯•
```

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

### application.yml

```yaml
server:
  port: 8080  # åº”ç”¨ç«¯å£

langchain4j:
  open-ai:
    chat-model:
      api-key: sk-xxx        # ä½ çš„ API Key
      base-url: https://...  # API åŸºç¡€ URL
      model-name: qwen-plus  # æ¨¡å‹åç§°
      temperature: 0.7       # éšæœºæ€§ï¼ˆ0.0-2.0ï¼‰
      max-tokens: 2000       # æœ€å¤§è¾“å‡ºé•¿åº¦

logging:
  level:
    com.yihu.agent: DEBUG    # åº”ç”¨æ—¥å¿—çº§åˆ«
    dev.langchain4j: DEBUG   # LangChain4j æ—¥å¿—çº§åˆ«
```

## ğŸ‰ æˆåŠŸæ ‡å¿—

å½“ä½ çœ‹åˆ°ä»¥ä¸‹ç°è±¡æ—¶ï¼Œè¯´æ˜ä¸€åˆ‡æ­£å¸¸ï¼š

âœ… åº”ç”¨å¯åŠ¨æ— é”™è¯¯  
âœ… è®¿é—® health ç«¯ç‚¹è¿”å› `{"status":"ok"}`  
âœ… å‰ç«¯é¡µé¢åŠ è½½æ­£å¸¸  
âœ… å¯ä»¥æ­£å¸¸å‘é€æ¶ˆæ¯  
âœ… AI èƒ½æ­£ç¡®å“åº”  
âœ… æµè§ˆå™¨æ§åˆ¶å°æ— é”™è¯¯  

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [LangGraph4j å®ç°è¯´æ˜](./langgraph4j-implementation-note.md)
- [CORS é…ç½®è¯´æ˜](./cors-configuration.md)
- [åŒ»ç–—å’¨è¯¢çŠ¶æ€å›¾](./åŒ»ç–—å’¨è¯¢çŠ¶æ€å›¾å®ç°æ€»ç»“.md)
- [API ä½¿ç”¨æŒ‡å—](./quick-start.md)

---

**æ›´æ–°æ—¶é—´**: 2025-11-05  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: âœ… æ‰€æœ‰é—®é¢˜å·²ä¿®å¤ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨

